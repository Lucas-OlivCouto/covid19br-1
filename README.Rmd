---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# Dados atualizados: `r Sys.Date()`

```{r setup, echo=FALSE, message=FALSE, cache=TRUE}
library(tidyverse)
library(covid19br)
library(geobr)
library(cowplot)
library(knitr)

n_total    <- covid_br_all %>% filter(date == Sys.Date()) %>% pull(confirmed_cases)

tab_stat <- covid_br_states %>% filter(date == Sys.Date()) %>% 
  dplyr::select(Estado = state, "Casos suspeitos" = suspected_cases, 
         "Casos confirmados" = confirmed_cases,
         "Casos descartados" = not_confirmed_cases) %>% 
  arrange(Estado) %>% as.data.frame()
```

# Crescimento do número de casos

```{r echo=FALSE, warning=FALSE, message=FALSE, fig.height=8, fig.width=10}

library(covid19br)
# calculate doubling time:

mod10    <- lm(log10(confirmed_cases + 1) ~ date, covid_br_all)
modlog   <- lm(log(confirmed_cases + 1) ~ date, covid_br_all)
dtime    <- log(2)/modlog$coef[2]   # time to double
dtime10  <- 1/mod10$coef[2]         # time to x 10

# Plots------
# Curva de crescimento no Brasil
g1 <- ggplot(covid_br_all, aes(y = confirmed_cases, x = date)) +
  geom_area(fill = "tomato", alpha = 0.6) +
  geom_line(color = "black") +
  scale_x_date(date_breaks = "2 days", date_labels =  "%d %b") +
  geom_segment(aes(x = as.Date("2020-02-25"), y = 150, xend = as.Date ("2020-02-25"), yend = 5),
               arrow = arrow(type =  "closed", length = unit(0.3, "cm"))) +
  annotate(geom='text', x = as.Date("2020-02-25"), y = 160, label = "Primeiro caso confirmado (25 de fevereiro)", hjust =  0, size = 7) +
  theme_cowplot(font_size = 16) +
  labs(y = "Casos confirmados (covid-19)",
       x = "Data",
       title = "Coronavirus no Brasil",
       subtitle = "O número de casos cresce exponencialmente",
       caption = "Fonte: dados do Ministério da Saúde | atualizado: 15/03/2020") +
   theme( plot.title = element_text(size = 16),
  plot.subtitle = element_text(size = 14),
  plot.caption = element_text(size = 10, hjust = 1));g1


# Tempo para dobrar o número de casos
g2 <- ggplot(covid_br_all, aes(y = confirmed_cases + 1, x = date)) +
  geom_point(color = "black", size = 4, shape = 21, fill = "tomato") +
  scale_y_continuous(trans = "log10") +
  geom_smooth(method = lm, color = "tomato") +
scale_x_date(date_breaks = "2 days", date_labels =  "%d %b") +
  theme_cowplot(font_size = 16) +
  labs(y = "Casos confirmados (covid-19) em escala log10",
       x = "Data",
       title = "Coronavirus no Brasil",
       subtitle = paste("A cada ", round(dtime10, 1), "dias o número de casos aumenta 10 vezes)"),
       caption = "Fonte: dados do Ministério da Saúde | atualizado: 15/03/2020") +
   theme( plot.title = element_text(size = 14),
  plot.subtitle = element_text(size = 14),
  plot.caption = element_text(size = 10, hjust = 1));g2
```

# Mapa de distribuição do Corona vírus no Brasil

```{r echo=FALSE, warning=FALSE, message=FALSE}
covid <- covid_br_states %>% filter(date == "2020-03-15")
covid$confir_cat <- cut(covid$confirmed_cases, breaks = c(-Inf, 0, 5, 10, 100, Inf), include.lowest = TRUE,
                        c("zero","entre 1 e 5", "entre 6 e 10", "entre 11 e 100", "maior que 100"))

states2 <-left_join(states, covid, by = c("abbrev_state" = "state_ID"))

colors <- c("gray", '#ffffb2','#fecc5c','#fd8d3c','#f03b20','#bd0026')

g1 <- ggplot() +
  geom_sf(data = states2, aes(fill = confir_cat), color= "black", size=.15) +
  scale_fill_manual(values = colors, name = "Casos confirmados") +
  theme_void(base_size = 16) +
  labs(title = "Corona vírus no Brasil",
       subtitle = paste(n_total, "casos confirmados no Brasil"),
       caption = paste("Fonte: dados do Ministério da Saúde | atualizado", Sys.Date())) +
  theme( plot.title = element_text(size = 16),
  plot.subtitle = element_text(size = 14),
  plot.caption = element_text(size = 10, hjust = 1)) 
g1
```

# Número de casos por estado

```{r echo=FALSE}
kable(tab_stat)
```

# Acesse os dados com o pacote: `covid19br`

The goal of covid19br is to provided updated information on the number of cases of corona virus for Brasil.

## Installation

You can install the released development version of covid19br from github with:

``` r
install.packages("devtools") 
devtools::install_github(repo = "paternogbc/covid19br")
```

## Help

In `R`, documentation for `covid19br` dataset can be accessed with the
standard `help` command (e.g., `?covid_br_all` and `?covid_br_states`).

For a online description of the dataset, see [reference
page](https://paternogbc.github.io/covid19br/reference/index.html)

## Load the package data

```{r example}
library(covid19br)
## basic example code

head(covid_br_all)
```


Please note that the 'covid19br' project is released with a
[Contributor Code of Conduct](CODE_OF_CONDUCT.md).
By contributing to this project, you agree to abide by its terms.
